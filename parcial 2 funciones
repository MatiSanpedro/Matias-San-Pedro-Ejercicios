#Funciones_del_juego
import pygame as pg
import time
import random

#matrices 

def matriz_de_10x10():
    matriz_final = []
    for i in range(10):
        fila = [0] *10
        matriz_final.append(fila)
    
    
        
        
    return matriz_final
    

def matriz_de_20x20():
    matriz_final = []
    for i in range(20):
        fila = [0] *20
        matriz_final.append(fila)
        
        
        
    return matriz_final



def matriz_de_40x40():
    matriz_final = []
    for i in range(40):
        fila = [0]  *40
        matriz_final.append(fila)
        
        
        
    return matriz_final

#Colocar naves en matriz al azar(requiere matriz):

def cero_uno_matriz_de_10(matriz):
    for i in range(20):
        fila = random.randint(0,9)
        columna = random.randint(0,9)

        largo = random.choice([1,2,3])
        
        if columna + largo <= 10: #no quiero que la matriz se agrande mas de 10
            for j in range(largo):
                matriz[fila][columna + j] = 1


    return matriz 




def barcos_de_matriz_10(matriz)-> list:

    #REFORMA DEL CODIGO DE BARCOS, USAR ESTE

    unos = [
            (1, 4),  #1 grupo de largo 4 (acorazado)
            (2, 3),  #2 grupos de largo 3 (cruceros)
            (3, 2),  #3 grupos de largo 2 (destructores)
            (4, 1),  #4 uno solo (submarino)
        
        ]

    for tupla in unos: #separo la tupla en 2, IZQ= cantidad de unos, DER= veces que se insertan los unos de la izquierda
        cantidad = tupla[0] 
        largo = tupla[1]
        for i in range(cantidad):
            colocado = False
            intentos = 0

            while not colocado and intentos < 50: #50 es solo un limite, quiero evitar que se haga infinito
                    fila = random.randint(0, 9)      #lugar al azar en fila
                    columna = random.randint(0, 10 - largo) #misma cosa, le resto "largo" para que no se pase del limite de 10
             

                    espacio_libre = True 
                    for j in range(largo):
                        if matriz[fila][columna + j] != 0: #reviso que exista espacio 
                        
                            espacio_libre = False 
                            break
                    
                    if espacio_libre == True:
                        for j in range(largo):
                            matriz[fila][columna + j] = 1
                    
                        colocado = True

                    intentos += 1

            if not colocado:
                    print(f" No se pudo colocar el ultimo {largo}")
                    
    
    return matriz


#escenario 

def dibujar_escenario(pantalla, tamaño:int,columna:int,fila:int):

    for filass in range(fila):
        for columnass in range(columna):
            rectangulo_agua = pg.Rect(columnass * tamaño, filass * tamaño, tamaño, tamaño)
            pg.draw.rect(pantalla, (0,0,200), rectangulo_agua)
            pg.draw.rect(pantalla, (0,0,0), rectangulo_agua, 1)
            

#dibujar los barcos (requiere la matriz)
#esto ademas de dibujarlos en pantalla, devuelve los rectangulos que dibuje en una lista 

def dibujar_barcos(pantalla,matriz:list,tamaño):

    lista_de_barcos = []

    for filass in range(len(matriz)):
        for columnass in range(len(matriz[0])):
            
            if matriz[filass][columnass] == 1:
                rectangulo = pg.Rect(columnass * tamaño, filass * tamaño, tamaño, tamaño)
                pg.draw.rect(pantalla,(60,0,0),rectangulo)
                pg.draw.rect(pantalla, (0, 0, 0), rectangulo, 1)
                
                lista_de_barcos.append(rectangulo)

            
    return lista_de_barcos




'''
matriz_creada = matriz_de_10x10()
efe = cero_uno(matriz_creada)
print(efe)
'''


def mostrar_menu(pantalla):
    pantalla.fill((50,50,50))
    fuente = pg.font.SysFont("Arial",50)
    texto = fuente.render("HACE CLICK PARA JUGAR",True, (255,255,255))
    pantalla.blit(texto, (100,200))

    for evento in pg.event.get():
        if evento.type ==pg.QUIT:
            return "salir"
        #if evento.type == pg.MOUSEBUTTONDOWN:
         #   return "juego"
    
    return "menu"


def mostrar_juego(pantalla):
    pantalla.fill((0,100,200))
    

    for evento in pg.event.get():
        if evento.type == pg.QUIT:
            return "salir"
        
    return "juego"


def funcion_teclado(evento):
        if evento.type == pg.KEYDOWN:
            if evento.key == pg.K_ESCAPE:
                print("se apretó esc")
            elif evento.key == pg.K_p:
                pg.mixer.music.pause()
            elif evento.key == pg.K_m:
                pg.mixer.music.stop()
            

        if evento.type == pg.KEYUP:
            print("se ha levantao la tecla")
        

#REINICIAR | requiere que le pase "evento" y "bandera_barcos"
def reiniciar_partida(evento,booleano): 
    if evento.type == pg.KEYDOWN and evento.key ==pg.K_r:
        booleano = False
    
    
    return booleano 



def funcion_mouse_menu(evento,boton1,boton2,boton3,boton4,pantalla_actual):
        
        if evento.type == pg.MOUSEBUTTONDOWN: 
            posicion = (evento.pos)
            print(f"{posicion}")

        
            if evento.button ==1:
                print("click izquierdo funciona")

            if boton1.collidepoint(posicion):                
                pantalla_actual = "nivel"

            elif boton2.collidepoint(posicion):
                print("click en RECTANGULO2 correcto")
                
            elif boton3.collidepoint(posicion):
                print("click en RECTAngulo 3 CORRECTO")

            elif boton4.collidepoint(posicion):
                pg.quit()
                quit()
                

            elif evento.button ==3:
                    print("click derecho funciona")

        if evento.type == pg.MOUSEBUTTONUP:
            print("se solto el click")

       


def pausar_despausar(evento):
    if evento.type == pg.KEYDOWN:
        if evento.key == pg.K_p: # P = pausa 
            pg.mixer.music.pause()
            print("sonido pausado")
        if evento.key == pg.K_o: #O = despausa
            pg.mixer.music.unpause()
            print("Sonido reanudado")

        
        

       
def funcion_mouse_nivel(evento,boton1_nivel,boton2_nivel,boton3_nivel):
    if evento.type == pg.MOUSEBUTTONDOWN: 
            posicion = (evento.pos)
            print(f"{posicion}")

        
            if evento.button ==1:
                print("click izquierdo funciona")

            if boton1_nivel.collidepoint(posicion):                
                print("click en rectangulo 1 correcto")

            elif boton2_nivel.collidepoint(posicion):
                print("click en RECTANGULO2 correcto")
                
            elif boton3_nivel.collidepoint(posicion):
                print("click en RECTAngulo 3 CORRECTO")
                

            elif evento.button ==3:
                    print("click derecho funciona")

            if evento.type == pg.MOUSEBUTTONUP:
                print("se solto el click")
